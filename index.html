<!DOCTYPE html>
<html lang="uz">
  <head>
    <link
      rel="icon"
      type="image/png"
      href="https://peculiar-azure-xpdzzqfo3r.edgeone.app/Skrinshot_2026-01-03_175603-removebg-preview.png"
    />

    <meta charset="UTF-8" />
    <title>Brand</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <style>
      :root {
        --bg: #020617;
        --text: #e5e7eb;
        --muted: #94a3b8;
        --accent: #38bdf8;
        --border: #1e293b;
        --danger: #ef4444;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        background: radial-gradient(circle at top, #020617, #000);
        color: var(--text);
        font-family: system-ui, sans-serif;
      }
      .app {
        display: flex;
        min-height: 100vh;
      }
      .sidebar {
        width: 240px;
        padding: 20px;
        border-right: 1px solid var(--border);
      }
      .sidebar button {
        width: 100%;
        padding: 12px;
        margin-top: 8px;
        background: none;
        border: none;
        color: var(--text);
        border-radius: 10px;
        text-align: left;
        cursor: pointer;
      }
      .sidebar button:hover {
        background: rgba(56, 189, 248, 0.15);
      }
      .main {
        flex: 1;
        padding: 24px;
        display: flex;
        justify-content: center;
      }
      .card {
        width: 100%;
        max-width: 540px;
        background: rgba(2, 6, 23, 0.75);
        border: 1px solid var(--border);
        border-radius: 18px;
        padding: 20px;
      }
      h1 {
        text-align: center;
        margin-top: 0;
      }
      label {
        font-size: 13px;
        color: var(--muted);
        margin-top: 10px;
        display: block;
      }
      input,
      button {
        width: 100%;
        padding: 14px;
        margin-top: 6px;
        border-radius: 12px;
        font-size: 16px;
      }
      input {
        background: transparent;
        border: 1px solid var(--border);
        color: var(--text);
      }
      button {
        border: none;
        background: linear-gradient(135deg, var(--accent), #0ea5e9);
        color: #000;
        font-weight: 700;
        cursor: pointer;
      }
      button:active {
        transform: scale(0.97);
      }
      ul {
        list-style: none;
        padding: 0;
        margin: 10px 0;
      }
      li {
        display: flex;
        justify-content: space-between;
        border-bottom: 1px dashed var(--border);
        padding: 8px 0;
        font-size: 14px;
      }
      .total {
        text-align: center;
        font-size: 22px;
        font-weight: 700;
        margin: 16px 0;
      }
      .pay {
        display: flex;
        gap: 10px;
        margin-top: 6px;
      }
      .pay button {
        flex: 1;
        background: transparent;
        color: var(--text);
        border: 1px solid var(--border);
      }
      .pay button.active {
        background: var(--accent);
        color: #000;
      }
      @media (max-width: 768px) {
        .app {
          flex-direction: column;
        }
        .sidebar {
          width: 100%;
          border-right: none;
          border-bottom: 1px solid var(--border);
        }
      }
    </style>
  </head>

  <body>
    <div class="app">
      <!-- SIDEBAR -->
      <aside class="sidebar">
        <button onclick="location.reload()">âž• Yangi buyurtma</button>
        <button onclick="openReport()">ðŸ“Š Hisobotlar</button>
      </aside>

      <!-- MAIN -->
      <main class="main">
        <div class="card">
          <h1>Yangi buyurtma</h1>

          <label>Ism</label>
          <input id="name" placeholder="Mijoz ismi" />

          <label>Telefon</label>
          <input id="phone" placeholder="+998 (__) ___-__-__" />

          <label>Manzil</label>
          <input id="address" placeholder="Masalan: Chilonzor, 12-mavze" />

          <label>Narx (1 mÂ²)</label>
          <input id="price" type="number" value="10000" />

          <label>Gilam oâ€˜lchami</label>
          <input id="l" type="number" placeholder="Uzunlik (m)" />
          <input id="w" type="number" placeholder="Eni (m)" />

          <button onclick="addItem()">âž• Gilam qoâ€˜shish</button>

          <ul id="list"></ul>

          <div class="total">Jami: <span id="total">0</span> soâ€˜m</div>

          <label>Toâ€˜lov usuli</label>
          <div class="pay">
            <button id="payCash" class="active" onclick="setPay('Naqd')">
              Naqd
            </button>
            <button id="payCard" onclick="setPay('Karta')">Karta</button>
          </div>

          <label>Toâ€˜langan summa</label>
          <input id="paid" type="number" placeholder="0" />

          <button onclick="saveOrder()">ðŸ§¾ Chek chiqarish</button>
        </div>
      </main>
    </div>

    <script>
      const API = "https://gilam-yuvish-backend.onrender.com";

      const nameInput = document.getElementById("name");
      const phoneInput = document.getElementById("phone");
      const addressInput = document.getElementById("address");
      const priceInput = document.getElementById("price");
      const lInput = document.getElementById("l");
      const wInput = document.getElementById("w");
      const paidInput = document.getElementById("paid");
      const list = document.getElementById("list");
      const totalEl = document.getElementById("total");

      let items = [];
      let paymentType = "Naqd";

      function openReport() {
        location.href = "hisobot.html";
      }

      /* ðŸ“ž TELEFON FORMAT */
      phoneInput.addEventListener("input", () => {
        let v = phoneInput.value.replace(/\D/g, "");
        if (v.startsWith("998")) v = v.slice(3);
        v = v.slice(0, 9);
        let r = "+998";
        if (v.length > 0) r += " (" + v.slice(0, 2);
        if (v.length >= 2) r += ")";
        if (v.length > 2) r += " " + v.slice(2, 5);
        if (v.length > 5) r += "-" + v.slice(5, 7);
        if (v.length > 7) r += "-" + v.slice(7, 9);
        phoneInput.value = r;
      });

      function setPay(t) {
        paymentType = t;
        payCash.classList.toggle("active", t === "Naqd");
        payCard.classList.toggle("active", t === "Karta");
      }

      function addItem() {
        const l = Number(lInput.value);
        const w = Number(wInput.value);
        const p = Number(priceInput.value);
        if (!l || !w) return alert("Oâ€˜lcham kiriting");

        items.push({ l, w, sum: l * w * p });
        lInput.value = wInput.value = "";
        render();
      }

      function render() {
        list.innerHTML = "";
        let sum = 0;
        items.forEach((i) => {
          sum += i.sum;
          list.innerHTML += `
        <li>
          <span>${i.l}Ã—${i.w}</span>
          <span>${i.sum.toLocaleString()}</span>
        </li>`;
        });
        totalEl.textContent = sum.toLocaleString();
      }

      async function saveOrder() {
        const name = nameInput.value.trim();
        if (!name) return alert("Ism kiriting");
        if (!items.length) return alert("Gilam qoâ€˜shing");

        const order = {
          name,
          phone: phoneInput.value,
          address: addressInput.value,
          items,
          total: items.reduce((s, i) => s + i.sum, 0),
          paid: Number(paidInput.value) || 0,
          paymentType,
        };

        await fetch(API + "/orders", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(order),
        });

        localStorage.setItem("currentOrder", JSON.stringify(order));

        items = [];
        render();
        nameInput.value =
          phoneInput.value =
          addressInput.value =
          paidInput.value =
            "";
        setPay("Naqd");

        window.open("print.html", "_blank");
      }
    </script>
  </body>
</html>
