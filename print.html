<!DOCTYPE html>
<html lang="uz">

<head>
  <meta charset="UTF-8" />
  <title>–ß–µ–∫</title>

  <link rel="icon" type="image/png"
    href="https://peculiar-azure-xpdzzqfo3r.edgeone.app/Skrinshot_2026-01-03_175603-removebg-preview.png" />

  <style>
    @media print {
      @page {
        size: 58mm auto;
        margin: 0;
      }
    }

    body {
      font-family: monospace;
      width: 58mm;
      margin: 0;
      padding: 6px;
      font-size: 12px;
      color: #000;
    }

    .center {
      text-align: center;
    }

    .bold {
      font-weight: bold;
    }

    .right {
      text-align: right;
    }

    .line {
      border-top: 1px dashed #000;
      margin: 6px 0;
    }

    .small {
      font-size: 11px;
      line-height: 1.3;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 12px;
    }

    td {
      padding: 2px 0;
    }
  </style>
</head>

<body>
  <div id="out"></div>

  <script>
    const d = JSON.parse(localStorage.getItem("printOrder"));

    if (!d || !Array.isArray(d.items)) {
      document.getElementById("out").innerHTML =
        "<div class='center'>–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö</div>";
    } else {
      const PRICE_PER_M2 = 15000;
      const PRICE_LABEL = 15;

      const date = new Date(d.createdAt || Date.now()).toLocaleString("ru-RU", {
        day: "2-digit",
        month: "long",
        year: "numeric",
        hour: "2-digit",
        minute: "2-digit",
      });

      let rows = "";
      let total = 0;

      d.items.forEach(i => {
        const l = Number(i.l) || 0;
        const w = Number(i.w) || 0;
        const sum = l * w * PRICE_PER_M2;
        total += sum;

        rows += `
          <tr>
            <td>–ö–û–í–ï–†</td>
            <td>${l}x${w} –º¬≤</td>
            <td class="right">${PRICE_LABEL}</td>
            <td class="right">${sum.toLocaleString()}</td>
          </tr>
        `;
      });

      document.getElementById("out").innerHTML = `
        <div class="center">
          <img src="https://peculiar-azure-xpdzzqfo3r.edgeone.app/Skrinshot_2026-01-03_175603-removebg-preview.png" width="110"><br>
          <div class="bold">–§–ê–ë–†–ò–ö–ê –ß–ò–°–¢–ö–ò –ö–û–í–†–û–í</div>
          <div class="small">
            –£–ª. –ë—É—é–∫ –ò–ø–∞–∫ –ô—É–ª–∏ 62–ê<br>
            –¢–∞—à–∫–µ–Ω—Ç<br>
            –¢–µ–ª: 71 203 82 82
          </div>
        </div>
  
        <div class="line"></div>
  
        <div class="center bold">${date}</div>
  
        <div class="line"></div>
  
        <div class="bold">${d.name}</div>
        <div class="small">${d.address || ""}</div>
        <div class="small">${d.phone || ""}</div>
  
        <div class="line"></div>
  
        <table>
          <tr class="bold">
            <td>–ù–∞–∏–º.</td>
            <td>–†–∞–∑–º–µ—Ä</td>
            <td class="right">–¶–µ–Ω–∞</td>
            <td class="right">–°—É–º–º–∞</td>
          </tr>
          ${rows}
        </table>
  
        <div class="line"></div>
  
        <div class="bold">–ò–¢–û–ì–û: ${total.toLocaleString()} —Å—É–º</div>
        <div>–û–ø–ª–∞—á–µ–Ω–æ: ${(Number(d.paid) || 0).toLocaleString()} —Å—É–º</div>
        <div>–¢–∏–ø –æ–ø–ª–∞—Ç—ã: ${d.paymentType || "-"}</div>
  
        <div class="line"></div>
  
        <div class="small">
          <b>–í–ù–ò–ú–ê–ù–ò–ï –ó–ê–ö–ê–ó–ß–ò–ö–ê!</b><br>
          –•–∏–º—á–∏—Å—Ç–∫–∞ —Å–Ω–∏–º–∞–µ—Ç —Å —Å–µ–±—è –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å –∑–∞ —Å–∫—Ä—ã—Ç—ã–µ –¥–µ—Ñ–µ–∫—Ç—ã –∏–∑–¥–µ–ª–∏—è,
          —Å–∏–ª—å–Ω—ã–π –∏–∑–Ω–æ—Å –∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏.<br>
          –ü—Ä–µ—Ç–µ–Ω–∑–∏–∏ –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–∫–∞–∑–∞.
        </div>
  
        <div class="line"></div>
  
        <div class="small">
          –ü–æ–¥–ø–∏—Å—å –∫–ª–∏–µ–Ω—Ç–∞: ______________________
        </div>
      `;

      // üñ® chop
      setTimeout(() => {
        window.print();
      }, 300);

      // ‚úÖ PRINTDAN KEYIN AVTO QAYTISH / YOPISH
      window.onafterprint = () => {
        localStorage.removeItem("printOrder");

        // agar popup bo‚Äòlsa ‚Äî yopiladi
        if (window.opener) {
          window.close();
        } else {
          // aks holda index.html ga qaytadi
          location.href = "index.html";
        }
      };
    }
  </script>

</body>

</html>