<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Чек</title>

    <style>
      @media print {
        @page {
          size: 58mm auto;
          margin: 0;
        }
      }

      body {
        width: 58mm;
        margin: 0;
        padding: 6px;
        font-family: monospace;
        font-size: 11px;
      }

      .center {
        text-align: center;
      }

      .bold {
        font-weight: 700;
      }

      .small {
        font-size: 10px;
      }

      .line {
        border-top: 1px dashed #000;
        margin: 6px 0;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      td {
        padding: 2px 0;
      }

      .right {
        text-align: right;
      }
    </style>
  </head>

  <body>
    <!-- LOGO -->
    <div class="center">
      <img
        src="https://peculiar-azure-xpdzzqfo3r.edgeone.app/Skrinshot_2026-01-03_175603-removebg-preview.png"
        width="120"
      />
      <div class="bold">BRAND ФАБРИКА ЧИСТКИ</div>
      <div class="small">
        Ул. Буюк Ипак Йули 62А<br />
        Ташкент<br />
        Тел: 71 203 82 82
      </div>
    </div>

    <div class="line"></div>

    <!-- SANA + CHEK -->
    <div class="center bold" id="dt"></div>
    <div class="center bold" id="orderno"></div>

    <div id="cust"></div>

    <div class="line"></div>

    <!-- JADVAL -->
    <table id="tbl">
      <tr class="bold">
        <td>Наим.</td>
        <td>Кол</td>
        <td class="right">Сумма</td>
      </tr>
    </table>

    <div class="line"></div>

    <!-- SUMMALAR -->
    <div id="total"></div>
    <div>Оплачено: <span id="paid"></span></div>
    <div>Остаток: <span id="rest"></span></div>

    <div class="line"></div>

    <div class="small">
      ВНИМАНИЕ ЗАКАЗЧИКА!<br />
      Химчистка не несет ответственности за скрытые дефекты изделия.
    </div>

    <div class="line"></div>

    <div class="small">Подпись клиента: ____________________</div>

    <script>
      const d = JSON.parse(localStorage.getItem("currentOrder") || "{}");

      // Sana
      dt.textContent = d.date || new Date().toLocaleString();

      // Chek raqami
      const no = Date.now().toString().slice(-4);
      orderno.textContent = "Чек № " + no;

      // Buyurtmachi
      cust.innerHTML = `
        <div><b>Заказчик:</b> ${d.name || "—"}</div>
        ${d.phone ? `<div>${d.phone}</div>` : ""}
      `;

      let sum = 0;

      d.items.forEach((i) => {
        sum += i.sum;
        tbl.innerHTML += `
          <tr>
            <td>КОВЕР</td>
            <td>${i.l}×${i.w}</td>
            <td class="right">${i.sum.toLocaleString()}</td>
          </tr>
        `;
      });

      total.textContent = "ИТОГО: " + sum.toLocaleString() + " сум";
      paid.textContent = (d.paid || 0).toLocaleString() + " сум";
      rest.textContent = (sum - (d.paid || 0)).toLocaleString() + " сум";

      window.print();
      window.onafterprint = () => window.close();
    </script>
  </body>
</html>
